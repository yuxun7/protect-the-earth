<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¬¬äº”é—œï¼šç”Ÿå‘½ç·šé¸æ“‡ - å°ä¸‘é­šçš„å†’éšª</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #81d4fa 0%, #4db6ac 100%);
      display: flex; flex-direction: column;
      align-items: center;
      height: 100vh;
      color: #004d40;
    }
    #introScreen {
      background: rgba(255,255,255,0.95);
      width: 90%;
      max-width: 600px;
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      margin-top: 40px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }
    #introScreen h2 { color: #00796b; margin-bottom: 15px; }
    #startGameBtn {
      padding: 12px 28px;
      font-size: 18px;
      background-color: #00796b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
    }
    #startGameBtn:hover { background-color: #004d40; }

    #gameWrapper {
      display: none;
      background: #e0f7fa;
      width: 90%;
      max-width: 600px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      padding: 20px;
      margin-top: 20px;
      flex-grow: 1;
      flex-direction: column;
      justify-content: space-between;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
      color: #00796b;
    }
    #energyBar {
      display: none;
      position: fixed;
      top: 15px;
      right: 15px;
      background: #004d40;
      color: white;
      padding: 8px 14px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 16px;
      user-select: none;
      z-index: 10;
    }
    #storyText {
      font-size: 18px;
      line-height: 1.5;
      min-height: 140px;
      margin-bottom: 20px;
      white-space: pre-line;
    }
    #choices {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    button.choiceBtn {
      background-color: #00796b;
      border: none;
      border-radius: 8px;
      padding: 14px;
      font-size: 16px;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button.choiceBtn:hover { background-color: #004d40; }

    #resultText {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
      color: #00796b;
      min-height: 30px;
    }
    #nextBtn, #restartBtn {
      margin-top: 25px;
      padding: 12px 24px;
      font-size: 18px;
      background-color: #00796b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: none;
      align-self: center;
    }
    #nextBtn:hover, #restartBtn:hover { background-color: #004d40; }
    #clownfishImg {
      display: block;
      margin: 0 auto 20px auto;
      max-width: 150px;
    }
  </style>
</head>
<body>

<!-- èƒŒæ™¯éŸ³æ¨‚ -->
<audio id="bgm" src="audio/bgm.mp3" loop></audio>

<div id="energyBar">èƒ½é‡å€¼: 100</div>

<!-- éŠæˆ²èªªæ˜ç•«é¢ -->
<div id="introScreen">
  <h2>ç¬¬äº”é—œï¼šç”Ÿå‘½ç·šé¸æ“‡</h2>
  <p>ä½ å°‡å¼•å°å°ä¸‘é­šåœ¨å—å¨è„…çš„æµ·æ´‹ç’°å¢ƒä¸­åšå‡ºé¸æ“‡ï¼Œä¿è­·ç‰ çš„èƒ½é‡èˆ‡æ£²æ¯åœ°ã€‚</p>
  <p>æ¯å€‹é¸æ“‡æœƒå½±éŸ¿å°ä¸‘é­šçš„èƒ½é‡å€¼ï¼Œç•¶èƒ½é‡è€—ç›¡ï¼ŒéŠæˆ²å°‡çµæŸï¼</p>
  <p>è®“æˆ‘å€‘çœ‹çœ‹ä½ æ˜¯å¦èƒ½æˆç‚ºçœŸæ­£çš„æµ·æ´‹å®ˆè­·è€…ï¼</p>
  <button id="startGameBtn">é–‹å§‹éŠæˆ²</button>
</div>

<!-- éŠæˆ²ä¸»ç•«é¢ -->
<div id="gameWrapper">
  <h1>ç¬¬äº”é—œï¼šç”Ÿå‘½ç·šé¸æ“‡<br>æ‹¯æ•‘å°ä¸‘é­š</h1>
  <img id="clownfishImg" src="images/clownfish.png" alt="å°ä¸‘é­š" />
  <div id="storyText"></div>
  <div id="choices"></div>
  <div id="resultText"></div>
  <button id="nextBtn" onclick="location.href='level6.html'">å‰å¾€ä¸‹ä¸€é—œ</button>
  <button id="restartBtn" onclick="restartGame()">é‡æ–°é–‹å§‹</button>
</div>

<script>
  const bgm = document.getElementById('bgm');
  const energyBar = document.getElementById('energyBar');
  const storyText = document.getElementById('storyText');
  const choicesDiv = document.getElementById('choices');
  const resultText = document.getElementById('resultText');
  const nextBtn = document.getElementById('nextBtn');
  const restartBtn = document.getElementById('restartBtn');
  const introScreen = document.getElementById('introScreen');
  const gameWrapper = document.getElementById('gameWrapper');
  const startGameBtn = document.getElementById('startGameBtn');

  let energy = 100;

  const scenes = {
    start: {
      text: "å°ä¸‘é­šåœ¨çŠç‘šç¤é™„è¿‘æ¸¸æ³³ï¼Œä½†ç™¼ç¾çŠç‘šç™½åŒ–åš´é‡ï¼Œæ£²æ¯åœ°å—åˆ°å¨è„…ã€‚ä½ è¦æ€éº¼å¹«åŠ©ç‰ ï¼Ÿ",
      choices: [
        { text: "å¹«åŠ©æ¸…ç†æµ·æ´‹åƒåœ¾", energyChange: +10, next: "coralCleanup" },
        { text: "å°‹æ‰¾æ–°çš„æ£²æ¯åœ°", energyChange: 0, next: "findNewHome" },
        { text: "ä¸ç†æœƒï¼Œç¹¼çºŒæ¸¸æ³³", energyChange: -20, next: "ignoreProblem" },
      ]
    },
    coralCleanup: {
      text: "ä½ å¸¶è‘—å°ä¸‘é­šå’Œæµ·æ´‹å¿—å·¥ä¸€èµ·æ¸…ç†åƒåœ¾ï¼ŒçŠç‘šæ¼¸æ¼¸æ¢å¾©å¥åº·ï¼Œå°ä¸‘é­šæ„Ÿè¦ºæ´»åŠ›å……æ²›ã€‚",
      choices: [
        { text: "ç¹¼çºŒå®ˆè­·çŠç‘šç¤", energyChange: +10, next: "educateCommunity" },
        { text: "æš«æ™‚ä¼‘æ¯ï¼Œè§€å¯Ÿç’°å¢ƒ", energyChange: 0, next: "monitorChanges" },
        { text: "å»æ¢ç´¢é™„è¿‘æµ·åŸŸ", energyChange: -5, next: "exploreNearby" },
      ]
    },
    findNewHome: {
      text: "å°ä¸‘é­šå˜—è©¦å°‹æ‰¾æ–°çš„æ£²æ¯åœ°ï¼Œä½†æ–°çš„åœ°æ–¹ä¹Ÿæœ‰æ•æ’ˆå’Œæ±¡æŸ“å•é¡Œï¼Œèƒ½é‡é€æ¼¸æ¸›å°‘ã€‚",
      choices: [
        { text: "å›å»å®ˆè­·åŸæœ¬çŠç‘šç¤", energyChange: +5, next: "coralCleanup" },
        { text: "å†’éšªç¹¼çºŒå°‹æ‰¾", energyChange: -15, next: "finalBad" },
        { text: "èˆ‡å…¶ä»–é­šé¡åˆä½œ", energyChange: +5, next: "cooperateFish" },
      ]
    },
    ignoreProblem: {
      text: "ä¸ç†æœƒå•é¡Œï¼Œå°ä¸‘é­šçš„æ£²æ¯åœ°é€æ¼¸æƒ¡åŒ–ï¼Œç‰ æ„Ÿåˆ°è¶Šä¾†è¶Šè™›å¼±ã€‚",
      choices: [
        { text: "ç¾åœ¨å¾Œæ‚”ï¼Œé–‹å§‹è¡Œå‹•", energyChange: +5, next: "coralCleanup" },
        { text: "æ”¾æ£„ï¼Œæ¸¸å‘æ›´é çš„æµ·åŸŸ", energyChange: -20, next: "finalBad" },
        { text: "å°‹æ±‚æµ·æ´‹å®ˆè­·è€…å¹«åŠ©", energyChange: +10, next: "guardianHelp" },
      ]
    },
    educateCommunity: {
      text: "ä½ é–‹å§‹å‘ç¤¾å€å®£å°ä¿è­·æµ·æ´‹çš„é‡è¦ï¼Œå°ä¸‘é­šçš„ç”Ÿæ´»ç’°å¢ƒé€æ¼¸æ”¹å–„ã€‚",
      choices: [
        { text: "çµ„ç¹”æµ·æ´‹ä¿è­·æ´»å‹•", energyChange: +10, next: "finalGood" },
        { text: "åªåšä¸€èˆ¬å®£å°", energyChange: 0, next: "finalGood" },
        { text: "å°‹æ±‚æ”¿åºœæ”¯æŒ", energyChange: +15, next: "finalGood" },
      ]
    },
    monitorChanges: {
      text: "ä½ å¯†åˆ‡è§€å¯ŸçŠç‘šç¤è®ŠåŒ–ï¼Œæº–å‚™éš¨æ™‚æ¡å–è¡Œå‹•ã€‚",
      choices: [
        { text: "ä¸»å‹•ä¿®å¾©çŠç‘š", energyChange: +10, next: "finalGood" },
        { text: "ç­‰å¾…è‡ªç„¶æ¢å¾©", energyChange: -10, next: "finalBad" },
        { text: "è«‹å°ˆå®¶è©•ä¼°", energyChange: +5, next: "finalGood" },
      ]
    },
    exploreNearby: {
      text: "åœ¨é™„è¿‘æµ·åŸŸï¼Œå°ä¸‘é­šé‡è¦‹è¨±å¤šæµ·æ´‹ç”Ÿç‰©ï¼Œä½†ä¹Ÿç™¼ç¾æ›´å¤šæ±¡æŸ“å•é¡Œã€‚",
      choices: [
        { text: "å¹«åŠ©å—å›°æ°´æ¯", energyChange: +10, next: "finalGood" },
        { text: "å¿½ç•¥ï¼Œç¹¼çºŒæ¢ç´¢", energyChange: -10, next: "finalBad" },
        { text: "è¨˜éŒ„ç’°å¢ƒç‹€æ³", energyChange: +5, next: "monitorChanges" },
      ]
    },
    cooperateFish: {
      text: "èˆ‡å…¶ä»–é­šé¡åˆä½œï¼Œå…±åŒå°æŠ—æ±¡æŸ“å¨è„…ï¼Œå°ä¸‘é­šé€æ¼¸æ¢å¾©æ´»åŠ›ã€‚",
      choices: [
        { text: "åŠ å¼·åˆä½œ", energyChange: +10, next: "finalGood" },
        { text: "æ”¾æ…¢è…³æ­¥", energyChange: 0, next: "finalGood" },
        { text: "å°‹æ‰¾ç›Ÿå‹", energyChange: +5, next: "finalGood" },
      ]
    },
    guardianHelp: {
      text: "æµ·æ´‹å®ˆè­·è€…è½åˆ°å‘¼å–šï¼Œé–‹å§‹å¹«åŠ©æ”¹å–„æ£²æ¯ç’°å¢ƒã€‚",
      choices: [
        { text: "å”åŠ©å®ˆè­·è€…å·¥ä½œ", energyChange: +10, next: "finalGood" },
        { text: "ä¿æŒè·é›¢è§€å¯Ÿ", energyChange: -5, next: "finalBad" },
        { text: "å°‹æ±‚æ›´å¤šå¹«åŠ©", energyChange: +5, next: "finalGood" },
      ]
    },
    finalGood: {
      text: "å°ä¸‘é­šåœ¨ä½ çš„å¹«åŠ©ä¸‹æ¢å¾©æ´»åŠ›ï¼ŒçŠç‘šç¤ç”Ÿæ…‹é€æ¼¸å¾©åŸï¼Œç‰ å¾—ä»¥ç¹¼çºŒå¿«æ¨‚ç”Ÿæ´»ï¼",
      choices: [],
      ending: "win"
    },
    finalBad: {
      text: "å°ä¸‘é­šå› ç‚ºç’°å¢ƒæƒ¡åŒ–ï¼Œèƒ½é‡è€—ç›¡ï¼Œæœ€çµ‚å¤±å»äº†æ£²æ¯åœ°...å¸Œæœ›æœªä¾†èƒ½æœ‰æ›´å¤šäººä¿è­·æµ·æ´‹ã€‚",
      choices: [],
      ending: "lose"
    }
  };

  function updateEnergy(change) {
    energy += change;
    if (energy > 100) energy = 100;
    if (energy < 0) energy = 0;
    energyBar.textContent = `èƒ½é‡å€¼: ${energy}`;
  }

  function clearChoices() {
    choicesDiv.innerHTML = '';
    resultText.textContent = '';
    nextBtn.style.display = 'none';
    restartBtn.style.display = 'none';
  }

  function showScene(sceneKey) {
    clearChoices();
    const scene = scenes[sceneKey];
    storyText.textContent = scene.text;

    if (scene.ending) {
      resultText.textContent = scene.ending === "win"
        ? "ğŸ‰ æ­å–œä½ æ‹¯æ•‘äº†å°ä¸‘é­šï¼"
        : "ğŸ’” å°ä¸‘é­šå¤±å»äº†æ£²æ¯åœ°...";
      restartBtn.style.display = 'block';
      return;
    }

    scene.choices.forEach(choice => {
      const btn = document.createElement('button');
      btn.className = 'choiceBtn';
      btn.textContent = choice.text;
      btn.addEventListener('click', () => {
        updateEnergy(choice.energyChange);
        if (energy <= 0) {
          showScene("finalBad");
          return;
        }
        showScene(choice.next);
      });
      choicesDiv.appendChild(btn);
    });
  }

  function restartGame() {
    energy = 100;
    energyBar.textContent = `èƒ½é‡å€¼: ${energy}`;
    nextBtn.style.display = 'none';
    restartBtn.style.display = 'none';
    resultText.textContent = '';
    showScene('start');
  }

  startGameBtn.onclick = () => {
    introScreen.style.display = 'none';
    gameWrapper.style.display = 'flex';
    energyBar.style.display = 'block';
    bgm.play(); // æ’­æ”¾èƒŒæ™¯éŸ³æ¨‚
    restartGame();
  };
</script>
</body>
</html>
